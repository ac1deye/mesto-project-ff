(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(t,o,r,i,a){var u,c=e.querySelector(".card").cloneNode(!0),s=c.querySelector(".card__delete-button"),l=c.querySelector(".card__image"),p=c.querySelector(".card__like-count");return l.src=t.link,l.alt=t.name,c.querySelector(".card__title").textContent=t.name,c.addEventListener("click",(function(e){e.target.classList.contains("card__delete-button")?r(t,c):e.target.classList.contains("card__like-button")?i(t,c):e.target.classList.contains("card__image")&&a(t)})),p.textContent=null===(u=t.likes)||void 0===u?void 0:u.length,t.owner._id!==o._id&&s.remove(),t.likes.some((function(e){return e._id==o._id}))&&n(t,c),c}function n(e,t){var n;t.querySelector(".card__like-button").classList.toggle("card__like-button_is-active"),t.querySelector(".card__like-count").textContent=null===(n=e.likes)||void 0===n?void 0:n.length}function o(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",a),e.addEventListener("click",i)}function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a),e.removeEventListener("click",i)}function i(e){e.target.classList.contains("popup")&&r(e.target)}function a(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&r(t)}}function u(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){c({formElement:e,inputElement:n,inputErrorClass:t.inputErrorClass,errorClass:t.errorClass})})),s({inputList:n,buttonElement:o,inactiveButtonClass:t.inactiveButtonClass})}function c(e){var t=e.formElement,n=e.inputElement,o=e.inputErrorClass,r=e.errorClass,i=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(o),i.classList.remove(r),i.textContent=""}function s(e){var t=e.inputList,n=e.buttonElement,o=e.inactiveButtonClass;!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?n.classList.remove(o):n.classList.add(o)}var l,p={baseUrl:"https://nomoreparties.co/v1/wff-cohort-6",headers:{authorization:"6fb73fc5-4183-4547-a0dc-b05287b42d77","Content-Type":"application/json"}},d=document.querySelector(".places__list"),m=document.querySelector(".profile__edit-button"),_=document.querySelector(".profile__add-button"),f=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_edit-avatar"),h=document.querySelector(".popup_type_new-card"),y=document.querySelector(".popup_type_image"),E=document.querySelector(".popup_type_remove-card"),b=document.querySelector(".profile__image"),C=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),k=document.forms["edit-profile"],L=k.elements.name,q=k.elements.description,g=document.forms["edit-avatar"],B=g.elements.link,j=document.forms["new-place"],x=j.elements["place-name"],w=j.elements.link,P=y.querySelector(".popup__image"),z=y.querySelector(".popup__caption"),A=document.forms["remove-card"],U={name:"",about:"",avatar:""},T=null,D=null;function M(e,t){D={card:e,cardElement:t},o(E)}function N(e,t){var o=!T.find((function(t){return t._id===e._id})).likes.some((function(e){return e._id==U._id}));(function(e,t){return fetch("".concat(p.baseUrl,"/cards/likes/").concat(e._id),{method:t?"PUT":"DELETE",headers:{authorization:p.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(e,o).then((function(e){var o={_id:e._id,name:e.name,link:e.link,likes:e.likes,owner:e.owner},r=T.findIndex((function(e){return e._id===o._id}));T[r]=o,n(o,t)})).catch((function(e){console.log(e)}))}function O(e){P.src=e.link,P.alt=e.name,z.textContent=e.name,o(y)}function I(e,t){e.elements.button.textContent=t?"Сохранение...":"Сохранить"}function J(e){C.textContent=e.name,S.textContent=e.about,b.style.backgroundImage="url(".concat(e.avatar,")"),m.style.visibility=null==e._id?"hidden":"visible"}m.addEventListener("click",(function(){L.value=C.textContent,q.value=S.textContent,u(k,{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input_error-description_active"}),o(f)})),b.addEventListener("click",(function(){B.value="",u(v,{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input_error-description_active"}),o(v)})),_.addEventListener("click",(function(){x.value="",w.value="",u(j,{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input_error-description_active"}),o(h)})),k.addEventListener("submit",(function(e){e.preventDefault(),I(k,!0),function(e){return fetch("".concat(p.baseUrl,"/users/me"),{method:"PATCH",headers:p.headers,body:JSON.stringify({name:e.name,about:e.about})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}({name:L.value,about:q.value}).then((function(e){U.name=e.name,U.about=e.about,J(U),r(f)})).catch((function(e){console.log(e)})).finally((function(){I(k,!1)}))})),g.addEventListener("submit",(function(e){var t;e.preventDefault(),I(g,!0),(t=B.value,fetch("".concat(p.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:p.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){U.avatar=e.avatar,J(U),r(v)})).catch((function(e){console.log(e)})).finally((function(){I(g,!1)}))})),j.addEventListener("submit",(function(e){var n;e.preventDefault(),I(j,!0),(n={name:x.value,link:w.value},fetch("".concat(p.baseUrl,"/cards"),{method:"POST",headers:p.headers,body:JSON.stringify({name:n.name,link:n.link})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var n={_id:e._id,name:e.name,link:e.link,likes:e.likes,owner:e.owner};T.unshift(n);var o=t(n,U,M,N,O);d.prepend(o),r(h),j.reset()})).catch((function(e){console.log(e)})).finally((function(){I(j,!1)}))})),A.addEventListener("submit",(function(e){var t;e.preventDefault(),r(E),null!==D&&(t=D.card,fetch("".concat(p.baseUrl,"/cards/").concat(t._id),{method:"DELETE",headers:{authorization:p.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var t=T.findIndex((function(e){return e._id===D.card._id}));T.splice(t,t+1),D.cardElement.remove()})).catch((function(e){console.log(e)})).finally((function(){D=null}))})),document.querySelectorAll(".popup__close").forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){r(t)}))})),l={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input_error-description_active"},Array.from(document.querySelectorAll(l.formSelector)).forEach((function(e){!function(e){var t=e.formElement,n=e.inputSelector,o=e.submitButtonSelector,r=e.inactiveButtonClass,i=e.inputErrorClass,a=e.errorClass,u=Array.from(t.querySelectorAll(n)),l=t.querySelector(o);u.forEach((function(e){e.addEventListener("input",(function(){!function(e){var t=e.formElement,n=e.inputElement,o=e.inputErrorClass,r=e.errorClass;n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?c({formElement:t,inputElement:n,inputErrorClass:o,errorClass:r}):function(e){var t=e.inputElement,n=e.errorMessage,o=e.inputErrorClass,r=e.errorClass,i=e.formElement.querySelector(".".concat(t.id,"-error"));t.classList.add(o),i.textContent=n,i.classList.add(r)}({formElement:t,inputElement:n,errorMessage:n.validationMessage,inputErrorClass:o,errorClass:r})}({formElement:t,inputElement:e,inputErrorClass:i,errorClass:a}),s({inputList:u,buttonElement:l,inactiveButtonClass:r})}))}))}({formElement:e,inputSelector:l.inputSelector,submitButtonSelector:l.submitButtonSelector,inactiveButtonClass:l.inactiveButtonClass,inputErrorClass:l.inputErrorClass,errorClass:l.errorClass})})),J(U),Promise.all([fetch("".concat(p.baseUrl,"/users/me"),{headers:{authorization:p.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),fetch("".concat(p.baseUrl,"/cards"),{headers:{authorization:p.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(e){J(U={_id:e[0]._id,name:e[0].name,about:e[0].about,avatar:e[0].avatar}),function(e,n){e.forEach((function(e){var o=t(e,n,M,N,O);d.append(o)}))}(T=e[1].map((function(e){return{_id:e._id,name:e.name,link:e.link,likes:e.likes,owner:e.owner}})),U)})).catch((function(e){console.log(e)}))})();