(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(t,r,o,i,a){var u,c=e.querySelector(".card").cloneNode(!0),s=c.querySelector(".card__delete-button"),l=c.querySelector(".card__image"),d=c.querySelector(".card__like-count");return l.src=t.link,l.alt=t.name,c.querySelector(".card__title").textContent=t.name,c.addEventListener("click",(function(e){e.target.classList.contains("card__delete-button")?o(t,c):e.target.classList.contains("card__like-button")?i(t,c):e.target.classList.contains("card__image")&&a(t)})),d.textContent=null===(u=t.likes)||void 0===u?void 0:u.length,t.owner._id!==r._id&&s.remove(),t.likes.some((function(e){return e._id==r._id}))&&n(t,c),c}function n(e,t){var n;t.querySelector(".card__like-button").classList.toggle("card__like-button_is-active"),t.querySelector(".card__like-count").textContent=null===(n=e.likes)||void 0===n?void 0:n.length}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",a),e.addEventListener("click",i)}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a),e.removeEventListener("click",i)}function i(e){e.target.classList.contains("popup")&&o(e.target)}function a(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&o(t)}}function u(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){c({formElement:e,inputElement:n,inputErrorClass:t.inputErrorClass,errorClass:t.errorClass})})),s({inputList:n,buttonElement:r,inactiveButtonClass:t.inactiveButtonClass})}function c(e){var t=e.formElement,n=e.inputElement,r=e.inputErrorClass,o=e.errorClass,i=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(r),i.classList.remove(o),i.textContent=""}function s(e){var t=e.inputList,n=e.buttonElement,r=e.inactiveButtonClass,o=function(e){return e.some((function(e){return!e.validity.valid}))}(t);n.disabled=o,o?n.classList.add(r):n.classList.remove(r)}function l(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";t.textContent=e?r:n}function m(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";t.preventDefault();var r=t.submitter,o=r.textContent;d(!0,r,o,n),e().then((function(){t.target.reset()})).catch(console.error).finally((function(){d(!1,r,o)}))}var p={baseUrl:"https://nomoreparties.co/v1/wff-cohort-6",headers:{authorization:"6fb73fc5-4183-4547-a0dc-b05287b42d77","Content-Type":"application/json"}};function f(e,t){return fetch("".concat(p.baseUrl).concat(e),t).then(l)}var v={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input_error-description_active"},_=document.querySelector(".places__list"),E=document.querySelector(".profile__edit-button"),y=document.querySelector(".profile__add-button"),h=document.querySelector(".popup_type_edit"),C=document.querySelector(".popup_type_edit-avatar"),S=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_image"),k=document.querySelector(".popup_type_remove-card"),L=document.querySelector(".profile__image"),q=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),x=document.forms["edit-profile"],B=x.elements.name,w=x.elements.description,z=document.forms["edit-avatar"],A=z.elements.link,T=document.forms["new-place"],P=T.elements["place-name"],M=T.elements.link,N=b.querySelector(".popup__image"),O=b.querySelector(".popup__caption"),j=document.forms["remove-card"],D={name:"",about:"",avatar:""},I=null,J=null;function U(e,t){J={card:e,cardElement:t},r(k)}function H(e,t){var r=!I.find((function(t){return t._id===e._id})).likes.some((function(e){return e._id==D._id}));(function(e,t){return f("/cards/likes/".concat(e._id),{method:t?"PUT":"DELETE",headers:{authorization:p.headers.authorization}})})(e,r).then((function(e){var r={_id:e._id,name:e.name,link:e.link,likes:e.likes,owner:e.owner},o=I.findIndex((function(e){return e._id===r._id}));I[o]=r,n(r,t)})).catch(console.error)}function V(e){N.src=e.link,N.alt=e.name,O.textContent=e.name,r(b)}function F(e){q.textContent=e.name,g.textContent=e.about,L.style.backgroundImage="url(".concat(e.avatar,")"),E.style.visibility=null==e._id?"hidden":"visible"}E.addEventListener("click",(function(){B.value=q.textContent,w.value=g.textContent,u(x,v),r(h)})),L.addEventListener("click",(function(){A.value="",u(C,v),r(C)})),y.addEventListener("click",(function(){P.value="",M.value="",u(T,v),r(S)})),x.addEventListener("submit",(function(e){m((function(){return function(e){return f("/users/me",{method:"PATCH",headers:p.headers,body:JSON.stringify({name:e.name,about:e.about})})}({name:B.value,about:w.value}).then((function(e){D.name=e.name,D.about=e.about,F(D),o(h)}))}),e)})),z.addEventListener("submit",(function(e){m((function(){return(e=A.value,f("/users/me/avatar",{method:"PATCH",headers:p.headers,body:JSON.stringify({avatar:e})})).then((function(e){D.avatar=e.avatar,F(D),o(C)}));var e}),e)})),T.addEventListener("submit",(function(e){m((function(){return(e={name:P.value,link:M.value},f("/cards",{method:"POST",headers:p.headers,body:JSON.stringify({name:e.name,link:e.link})})).then((function(e){var n={_id:e._id,name:e.name,link:e.link,likes:e.likes,owner:e.owner};I.unshift(n);var r=t(n,D,U,H,V);_.prepend(r),o(S)}));var e}),e)})),j.addEventListener("submit",(function(e){m((function(){return(e=J.card,f("/cards/".concat(e._id),{method:"DELETE",headers:{authorization:p.headers.authorization}})).then((function(e){var t=I.findIndex((function(e){return e._id===J.card._id}));I.splice(t,t+1),J.cardElement.remove(),J=null,o(k)}));var e}),e,"Удаление...")})),document.querySelectorAll(".popup__close").forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){o(t)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e){var t=e.formElement,n=e.inputSelector,r=e.submitButtonSelector,o=e.inactiveButtonClass,i=e.inputErrorClass,a=e.errorClass,u=Array.from(t.querySelectorAll(n)),l=t.querySelector(r);u.forEach((function(e){e.addEventListener("input",(function(){!function(e){var t=e.formElement,n=e.inputElement,r=e.inputErrorClass,o=e.errorClass;n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?c({formElement:t,inputElement:n,inputErrorClass:r,errorClass:o}):function(e){var t=e.inputElement,n=e.errorMessage,r=e.inputErrorClass,o=e.errorClass,i=e.formElement.querySelector(".".concat(t.id,"-error"));t.classList.add(r),i.textContent=n,i.classList.add(o)}({formElement:t,inputElement:n,errorMessage:n.validationMessage,inputErrorClass:r,errorClass:o})}({formElement:t,inputElement:e,inputErrorClass:i,errorClass:a}),s({inputList:u,buttonElement:l,inactiveButtonClass:o})}))}))}({formElement:t,inputSelector:e.inputSelector,submitButtonSelector:e.submitButtonSelector,inactiveButtonClass:e.inactiveButtonClass,inputErrorClass:e.inputErrorClass,errorClass:e.errorClass})}))}(v),Promise.all([f("/users/me",{headers:{authorization:p.headers.authorization}}),f("/cards",{headers:{authorization:p.headers.authorization}})]).then((function(e){F(D={_id:e[0]._id,name:e[0].name,about:e[0].about,avatar:e[0].avatar}),function(e,n){e.forEach((function(e){var r=t(e,n,U,H,V);_.append(r)}))}(I=e[1].map((function(e){return{_id:e._id,name:e.name,link:e.link,likes:e.likes,owner:e.owner}})),D)})).catch(console.error)})();